(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"EbT/":function(t,e,n){"use strict";n.r(e);var i=n("CcnG"),o=function(){},s=n("pMnS"),r=function(t){return t[t.enter=13]="enter",t[t.left=37]="left",t[t.up=38]="up",t[t.right=39]="right",t[t.down=40]="down",t}({});function a(t){return Boolean(r[t])}var c=function(){function t(){this.keys={}}return t.prototype.setKey=function(t,e){return a(t)&&(this.keys[r[t]]=e),this},t.prototype.reset=function(){return this.keys={},this},t}(),u=function(){function t(t){this.control=t,this.kcKeypress=new i.m}return t.prototype.onKeyboardPress=function(t){a(t.keyCode)&&(t.preventDefault(),this.kcKeypress.emit()),this.control.setKey(t.keyCode,"keyup"===t.type?0:1)},t.prototype.onTouch=function(t){var e=t.changedTouches.item(0).clientX;t.keyCode=e>window.innerWidth/2?r.right:r.left,this.onKeyboardPress(t)},t.prototype.controlTouchEnd=function(){this.control.reset()},t}(),h=n("Ip0R"),l=n("AytR"),p=n("T1DM"),f=n("xXU7"),d=n("pugT"),m=n("mrSG"),g=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return m.b(e,t),e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0?t.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(function(){return e.flush(null)})))},e.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(n("h9Dq").a),y=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m.b(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,i=-1,o=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++i<o&&(t=n.shift()));if(this.active=!1,e){for(;++i<o&&(t=n.shift());)t.unsubscribe();throw e}},e}(n("CS9Q").a))(g),b=n("Z6j7");function v(t){return parseInt(t,10)||0}var w=n("K9Ia"),P=n("bne5"),C=n("p0ib"),x=n("xMyE"),S=n("P6uZ"),O=n("FFOo"),k=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new E(t,this.total))},t}(),E=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.count=0,i}return m.b(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(O.a),j=function(){function t(){this.collection={},this.promisesCount=0,this.subject=new w.a}return t.prototype.add=function(t,e){var n=this;if(!this.collection[t]){var i=new Image,o=Object(P.a)(i,"load"),s=Object(P.a)(i,"error").pipe(Object(x.a)(function(){if(!l.a.production)throw new Error("Image "+t+" not found 404")}));Object(C.a)(o,s).pipe(Object(S.a)()).subscribe(function(){n.collection[t]=i,n.promisesCount--,n.subject.next()}),this.promisesCount++,i.src=e}return this},t.prototype.get=function(t){if(!l.a.production&&!this.collection[t])throw new Error("Image "+t+" not found in collection");return this.collection[t]},t.prototype.ready=function(){var t,e=this;return setTimeout(function(){return e.subject.next()}),this.subject.pipe((t=this.promisesCount,function(e){return e.lift(new k(t))}))},t}(),A=[255,255,255],T=function(t){function e(e){var n=t.call(this,e)||this;n.animationFrequency=100,n.destroyable=!1,n.intermediate=!1,n.spritesCount=1,n.colorPoints=[],n.someColorPointsOffset=0,n.someColorPointsStep=0,n.spritePosFromEnd=!1,Object.assign(n,e);var i=n.image.naturalWidth,o=n.image.naturalHeight/n.spritesCount;return n.points=[[0,0],[i,o]],n.spritePos=Object(b.a)(0,n.spritesCount-1),n.destroyable&&(n.ctx.fillStyle="#fff",n.ctx.fillRect(0,0,i,o),n.draw(),n.fillColorPoints(),n.ctx.clearRect(0,0,n.ctx.canvas.width,n.ctx.canvas.height)),n}return Object(m.b)(e,t),e.prototype.draw=function(){var t=[this.image.naturalWidth,this.image.naturalHeight/this.spritesCount];return this.ctx.drawImage(this.image,0,t[1]*this.spritePos,t[0],t[1],this.points[0][0],this.points[0][1],t[0],t[1]),this},e.prototype.isDestroyed=function(){var t=this;return this.someColorPoints().some(function(e){var n=e[0],i=e[1],o=e.slice(2),s=t.points[0],r=t.ctx.getImageData(n+s[0],i+s[1],1,1).data;return o.some(function(t,e){return r[e]!==t})})},e.prototype.someColorPoints=function(){for(var t=this.colorPoints,e=[],n=this.someColorPointsOffset;n<t.length;n+=this.someColorPointsStep)e.push(t[n]);return this.someColorPointsOffset++,this.someColorPointsOffset%=this.someColorPointsStep,e},e.prototype.isCrosses=function(t){var e=this;return this.someColorPoints().some(function(n){return t.points[0][0]<n[0]+e.points[0][0]&&t.points[0][1]<n[1]+e.points[0][1]&&t.points[1][0]>n[0]+e.points[0][0]&&t.points[1][1]>n[1]+e.points[0][1]})},e.prototype.updateSprite=function(){this.intermediate?(this.spritePos+=this.spritePosFromEnd?-1:1,this.spritePos%this.spritesCount==0&&(this.spritePosFromEnd=!this.spritePosFromEnd,this.spritePosFromEnd&&this.spritePos--)):(this.spritePos++,this.spritePos%=this.spritesCount)},e.prototype.fillColorPoints=function(){for(var t=this.image.naturalWidth,e=this.image.naturalHeight/this.spritesCount,n=0;n<t;n++)for(var i=0;i<e;i++)if(this.checkColor(n,i,!0)){for(i=e-1;i>=0&&!this.checkColor(n,i);i--);break}for(i=0;i<e;i++)for(n=0;n<t;n++)if(this.checkColor(n,i)){for(n=t-1;n>=0&&!this.checkColor(n,i);n--);break}this.someColorPointsStep=Math.floor(this.colorPoints.length/4)},e.prototype.checkColor=function(t,e,n){void 0===n&&(n=!1);var i=this.ctx.getImageData(t,e,1,1).data;if(A.some(function(t,e){return t!==i[e]}))return!n&&this.colorPoints.find(function(n){return n[0]===t&&n[1]===e})||this.colorPoints.push([t,e,i[0],i[1]]),!0},e}(function(){function t(t){this.points=[[0,0],[0,150],[50,150],[50,0]],this.fillStyle="#ccedff",this.lineWidth=3,this.strokeStyle="#123",Object.assign(this,t)}return t.prototype.draw=function(){var t=this.ctx;t.beginPath(),t.moveTo(this.points[0][0],this.points[0][1]);for(var e=1;e<this.points.length;e++)t.lineTo(this.points[e][0],this.points[e][1]);return t.closePath(),Object.assign(t,this,{points:null}),t.fill(),t.stroke(),this},t.prototype.move=function(t,e){var n=this.getOverflowCorrection(t,e);return n?this.move(n[0],n[1]):this.points.forEach(function(n){n[0]+=Math.floor(t),n[1]+=Math.floor(e)}),this},t.prototype.getOverflowCorrection=function(t,e){for(var n=this.ctx.canvas,i=0,o=this.points;i<o.length;i++){var s=o[i],r=s[0],a=s[1],c=r+t<0?[-r,e]:r+t>n.width?[n.width-r,e]:a+e<0?[t,-a]:a+e>n.height&&[t,n.height-a];if(c)return c}return!1},t}()),I=function(t){function e(e){var n=t.call(this,e)||this;return n.speed=Object(b.a)(1,3),Object.assign(n,e),n}return Object(m.b)(e,t),e.prototype.move=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.speed);var n=this.ctx.canvas.height;return this.points[0][1]>=n&&(e=-1.5*n,this.speed=Object(b.a)(1,3)+this.globalSpeed.value),this.points.forEach(function(n){n[0]+=t,n[1]+=e}),this},e}(T),M=function(){function t(){this.value=0}return t.prototype.up=function(t){return void 0===t&&(t=.001),this.value+=t,this},t}(),K=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.acceleration=1,e}return Object(m.b)(e,t),e.prototype.accelerate=function(t,n){return this.getAxisSum(t,"x")||this.getAxisSum(t,"y")?this.acceleration-n.value<e.ACCELERATION_MAX&&(this.acceleration+=e.ACCELERATION_STEP):this.acceleration=1,this},e.prototype.moveByControl=function(t){return this.move(this.getAxisSum(t,"x"),this.getAxisSum(t,"y")),this},e.prototype.getAxisSum=function(t,e){var n=v("x"===e?t.right:t.down),i=v("x"===e?t.left:t.up),o=n-i;return Object.values(t).filter(Boolean).length!==n+i&&(o/=Math.SQRT2),o*this.acceleration},e.ACCELERATION_MAX=4,e.ACCELERATION_STEP=.5,e}(T),R=l.a.production?"/school/":"/",W="game-1.best-score",_=function(){function t(t,e){this.control=t,this.images=e,this.bestScore=localStorage.getItem(W),this.gameProcess=new d.a,this.gameProcess.unsubscribe()}return t.prototype.ngAfterViewInit=function(){var t=this;this.ctx=this.canvas.nativeElement.getContext("2d"),this.images.add("ice",R+"assets/ice.png").add("ironMan",R+"assets/iron-man.png").add("star",R+"assets/star.png"),this.images.ready().subscribe(function(){return t.initGame()})},t.prototype.ngOnDestroy=function(){this.gameProcess.unsubscribe()},t.prototype.onPressEnter=function(){this.control.keys.enter&&(this.gameProcess.closed?this.start():(this.gameProcess.unsubscribe(),this.drawPauseMessage()))},t.prototype.start=function(){var t=this;this.gameProcess=Object(f.a)(0,y).subscribe(function(){return t.game()}),this.gameProcess.add(Object(f.a)(100,p.a).subscribe(function(){return t.stars.forEach(function(t){return t.updateSprite()})}))},t.prototype.initGame=function(){this.control.reset(),this.gameSpeed=new M,this.score=0,this.barriers=[],this.stars=[];for(var t=this.ctx,e=t.canvas,n=e.width/11,i=0;i<11;i++){var o=new I({ctx:t,image:this.images.get("ice"),globalSpeed:this.gameSpeed}),s=n*i+(n-this.images.get("ice").width)/2;o.move(s,-Object(b.a)(120,e.height)),this.barriers.push(o)}for(i=0;i<30;i++){var r=new I({ctx:t,image:this.images.get("star"),spritesCount:3,intermediate:!0,globalSpeed:this.gameSpeed}),a=-Object(b.a)(120,e.height);r.move(e.width/30*i,a),this.stars.push(r)}this.hero=new K({ctx:t,image:this.images.get("ironMan"),destroyable:!0}),this.hero.move((e.width-this.images.get("ironMan").width)/2,e.height-100).draw(),e.focus(),this.drawPauseMessage()},t.prototype.game=function(){var t=this,e=this.ctx.canvas,n=this.control;this.ctx.clearRect(0,0,e.width,e.height),this.score++,this.gameSpeed.up(),this.hero.accelerate(n.keys,this.gameSpeed),this.stars.forEach(function(n){t.hero.isCrosses(n)?(t.score+=200,n.move(0,e.height-n.points[0][1]).move(0,-Object(b.a)(120,e.height))):n.move().draw()}),this.hero.moveByControl(n.keys).draw(),this.barriers.forEach(function(t){return t.move().draw()}),this.hero.isDestroyed()&&(this.gameProcess.unsubscribe(),this.score>v(this.bestScore)&&(localStorage.setItem(W,this.score.toString()),this.bestScore=this.score.toString()),this.initGame())},t.prototype.drawPauseMessage=function(){var t="PRESS ENTER TO "+(this.score?"CONTINUE":"START"),e=this.ctx,n=e.canvas;e.clearRect(n.width-110,n.height-30,100,30),e.fillStyle="#fff",e.font="bold 70px sans-serif",e.fillText("PAUSE",n.width/2-125,n.height/2,250),e.fillStyle="#ddd",e.font="bold 32px sans-serif",e.fillText(t,n.width/2-125,n.height/2+70,250)},t}(),F=i.Ma({encapsulation:0,styles:[["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:center;height:100%}.app-iron-man__canvas[_ngcontent-%COMP%]{background-color:#272737}@media (max-width:991.98px){.app-iron-man__canvas[_ngcontent-%COMP%]{width:100%;max-height:100%}}"]],data:{}});function N(t){return i.db(0,[(t()(),i.Oa(0,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),i.cb(1,null,["The Best Score: ",""]))],null,function(t,e){t(e,1,0,e.component.bestScore)})}function D(t){return i.db(0,[i.ab(402653184,1,{canvas:0}),(t()(),i.Oa(1,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),i.cb(2,null,["Score: ",""])),(t()(),i.Oa(3,0,[[1,0],["canvas",1]],null,1,"canvas",[["appKeyboardControl",""],["class","app-iron-man__canvas"],["height","600"],["tabindex","0"],["width","800"]],null,[[null,"touchstart"],[null,"kcKeypress"],[null,"keydown"],[null,"keyup"],[null,"touchend"]],function(t,e,n){var o=!0,s=t.component;return"keydown"===e&&(o=!1!==i.Ya(t,4).onKeyboardPress(n)&&o),"keyup"===e&&(o=!1!==i.Ya(t,4).onKeyboardPress(n)&&o),"touchstart"===e&&(o=!1!==i.Ya(t,4).onTouch(n)&&o),"touchend"===e&&(o=!1!==i.Ya(t,4).controlTouchEnd()&&o),"touchstart"===e&&(o=!1!==s.start()&&o),"kcKeypress"===e&&(o=!1!==s.onPressEnter()&&o),o},null,null)),i.Na(4,16384,null,0,u,[c],null,{kcKeypress:"kcKeypress"}),(t()(),i.Fa(16777216,null,null,1,null,N)),i.Na(6,16384,null,0,h.i,[i.N,i.K],{ngIf:[0,"ngIf"]},null)],function(t,e){t(e,6,0,e.component.bestScore)},function(t,e){t(e,2,0,e.component.score||0)})}var G=i.Ka("app-iron-man",_,function(t){return i.db(0,[(t()(),i.Oa(0,0,null,null,1,"app-iron-man",[],null,null,null,D,F)),i.Na(1,4374528,null,0,_,[c,j],null,null)],null,null)},{},{},[]),q=n("ZYCi"),B=function(){};n.d(e,"GamesModuleNgFactory",function(){return L});var L=i.La(o,[],function(t){return i.Va([i.Wa(512,i.j,i.Aa,[[8,[s.a,G]],[3,i.j],i.v]),i.Wa(4608,h.k,h.j,[i.s,[2,h.t]]),i.Wa(4608,c,c,[]),i.Wa(4608,j,j,[]),i.Wa(1073742336,h.b,h.b,[]),i.Wa(1073742336,q.m,q.m,[[2,q.s],[2,q.k]]),i.Wa(1073742336,B,B,[]),i.Wa(1073742336,o,o,[]),i.Wa(1024,q.i,function(){return[[{path:"iron-man",component:_}]]},[])])})}}]);